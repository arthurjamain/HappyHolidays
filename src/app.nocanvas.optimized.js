var NoCanvasApp=appBaseClass.extend({introTriangles:[],introRows:9,introColumnsCount:[1,1,3,3,4,2,0,5,3,2,2,7,1,0,2,8,0,0,1,3,3,5,4,0],triangleWidth:20,initialize:function(b){var a=this;this.device=b.device||"desktop";this.views={container:document.getElementById("container"),content:document.getElementById("content"),contentcopy:document.getElementById("contentcopy"),overlay:document.getElementById("overlay"),intro:document.getElementById("intro"),cover:document.getElementById("cover"),inShad:document.getElementById("insideshadow"),instructions:document.getElementById("instructions"),fakeCanvas:document.getElementById("fake-canvas")};this.setIntroElements();this.setIntroBounds();this.setContentBounds();$(window).on("resize",_.bind(function(){var e=$(this.views.content).height();var c=$(this.views.content).width();var f=($(document).width()-c)/2,d=($(document).height()-e)/2;f=f-f%this.triangleWidth;d=d-d%this.triangleWidth;this.views.fakeCanvas.style.left=f+"px";this.views.fakeCanvas.style.top=d+"px";this.views.content.style.left=f+"px";this.views.content.style.top=d+"px";this.views.instructions.style.left=(($(document).width()-50)/2)+"px";this.views.instructions.style.top=(d+450)+"px"},this));this.waitForImages(["img/cover.png","img/paper_pattern.png","img/background.png"],function(){setTimeout(_.bind(function(){$(a.views.container).css({display:"block",opacity:1});setTimeout(_.bind(function(){$(a.views.inShad).fadeOut(800);$(".logo").fadeIn(800);$(a.views.cover).fadeOut(800,_.bind(function(){this.triggerIntroAnimation(_.bind(function(){this.setContentElements();$(this.views.overlay).fadeIn(1000,function(){$(document.getElementById("fake-content")).css({display:"block"})});a.showInstructionPicto();$(this.views.intro).on("mouseover touchmove",function(){$(this).remove();if(a.instructionsLoop){clearInterval(a.instructionsLoop);$(a.views.instructions).remove()}if(!isMobile.apple.device){a.safeEndTimeout=setTimeout(function(){$(a.views.overlay).fadeOut("400",function(){$(a.views.overlay).remove();a.views.overlay=null});$(document).off("mousemove touchmove")},5000)}var c=(a.totalContentTriangles/100*10);$(document).on("mouseover touchmove",a.views.overlay,_.bind(a.deleteTrianglesUnderCursor,{hidden:0,toggle:0,threshold:c,views:{overlay:a.views.overlay}}))})},this))},this))},this),2000)},this),2000)})},setContentElements:function(){this.totalContentTriangles=$(this.views.content).width()/10*$(this.views.content).height()/20;var f=document.createElement("div");f.className="overlay-triangle";for(var d=0;d<this.totalContentTriangles;d++){var b=f.cloneNode();var e=this.getColor();b.style.borderLeftColor=e;b.style.borderRightColor=e;if(d%2!==0){b.className+=" odd"}else{b.style.borderBottomColor=e}b["data-index"]=d;this.views.overlay.appendChild(b)}},setIntroElements:function(){var d,a=this.views.intro,c=_.reduce(this.introColumnsCount,function(e,f){return e+f});for(var b=1;b<c;b++){d=document.createElement("div");d.className="intro-triangle";d.id="it"+b;this.introTriangles.push(d);a.appendChild(d)}$("#insideshadow").remove()},setIntroBounds:function(){var a=this.triangleWidth*this.introRows;var b=this.triangleWidth*this.introColumnsCount.length;var d=($(document).width()-b)/2,c=($(document).height()-a)/2;d=d-d%this.triangleWidth;c=c-c%this.triangleWidth;this.views.intro.style.height=a+"px";this.views.intro.style.width=b+"px"},deleteTrianglesUnderCursor:function(o){o.preventDefault();if((o.fromElement&&o.fromElement.className.indexOf("overlay-triangle")>-1)||(o.target&&o.target.className&&o.target.className.indexOf("overlay-triangle")>-1)){var p=0;var r;if(o.fromElement){r=o.fromElement;p=parseInt(o.fromElement["data-index"],10)}else{if(o.originalEvent.pageX&&o.originalEvent.pageY){r=document.elementFromPoint(o.originalEvent.pageX,o.originalEvent.pageY);p=parseInt(r["data-index"],10)}}if(!r){return}var q=[];var a=[];var s=(r.className.indexOf("odd")>-1);if(s){this.toggle++;if(this.toggle%2===0){q=[p,(p+1)];supplementaryTriangles=[(p+2)]}else{q=[(p-1),(p-2)];supplementaryTriangles=[(p-1),(p-3)]}for(var h in supplementaryTriangles){var n=$(this.views.overlay)[0].childNodes[supplementaryTriangles[h]];$(n).css({borderBottomColor:"transparent"})}for(var m in q){var b=$(this.views.overlay)[0].childNodes[q[m]];$(b).css({visibility:"hidden"})}}else{this.toggle++;q=[p,(p-2)];supplementaryTriangles=[(p-1)];for(var f in supplementaryTriangles){var d=$(this.views.overlay)[0].childNodes[supplementaryTriangles[f]];$(d).css({borderTopColor:"transparent"})}for(var g in q){var c=$(this.views.overlay)[0].childNodes[q[g]];$(c).css({visibility:"hidden"})}}this.toggle++;if(this.hidden>this.threshold){$(this.views.overlay).fadeOut("400",function(){if(this.views){$(this.views.overlay).remove();this.views.overlay=null}})}this.hidden++}},triggerIntroAnimation:function(a){setTimeout(_.bind(function(){this.triggerFirstIntroAnimation(function(){setTimeout(_.bind(function(){this.triggerSecondIntroAnimation(function(){if(typeof a==="function"){a.call(this)}})},this),500)})},this),500)},triggerFirstIntroAnimation:function(a){this.timeOffset=0;this.triangleOffset=0;var b=this;var f=1;var e=false;var g=_.reduce(this.introColumnsCount,function(h,i){return h+i});for(var d=0;d<this.introColumnsCount.length;d++){if(this.introColumnsCount[d]<5){for(var c=0;c<this.introColumnsCount[d];c++){setTimeout(_.bind(function(){var h=$(this.introTriangles[this.triangleOffset]);h.fadeIn(150,_.bind(function(){setTimeout(_.bind(function(){this.fadeOut(150)},this),100);if(b.triangleOffset==g&&!e){e=true;if(typeof a==="function"){a.call(b)}}},h));this.triangleOffset++},this),50*this.timeOffset);this.timeOffset++}}else{setTimeout(_.bind(function(){var i="";for(var h=this.first;h<this.first+b.introColumnsCount[this.i];h++){i+="#it"+(h)+","}i=i.substr(0,i.length-1);var k=$(i);k.fadeIn(150,_.bind(function(){setTimeout(_.bind(function(){this.fadeOut(150)},this),100);if(b.triangleOffset==g&&!e){e=true;if(typeof a==="function"){a.call(b)}}},k));b.triangleOffset+=b.introColumnsCount[this.i]},{i:d,first:f}),50*b.timeOffset);this.timeoffset++}f+=this.introColumnsCount[d]}},triggerSecondIntroAnimation:function(b){var e=_.reduce(this.introColumnsCount,function(g,h){return g+h});var f=this.splitArrayAtZeros(this.introColumnsCount);var a=0;var c=this;for(var d=0;d<f.length;d++){setTimeout(_.bind(function(){var i=0;for(var m=0;m<f[this.i].length;m++){for(var h=0;h<f[this.i][m];h++){i++}}for(var g=0;g<i;g++){var n=a;setTimeout(_.bind(function(){var j=$(this.introTriangles[n]);n++;j.fadeIn(200)},{introTriangles:this.introTriangles}),30*g);if(this.i==(f.length-1)&&g==(i-1)){setTimeout(function(){b.call(c)},(g+1)*30)}}a+=i},{i:d,introTriangles:this.introTriangles}),d*200)}},splitArrayAtZeros:function(a){var d=[];var b=[];for(var c in a){if(a[c]===0){if(b.length){d.push(b);b=[]}}else{b.push(a[c])}}return d},getRandomInt:function(b,a){return Math.round(Math.random()*(a-b+1))+b},getColor:function(){var b=0,d=0;for(var c in this.colors){b+=this.colors[c][1]}var e=Math.floor(Math.random()*b);for(var a in this.colors){d+=this.colors[a][1];if(e<d){return this.colors[a][0]}}}});